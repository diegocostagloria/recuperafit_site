(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[916],{8014:(e,a,s)=>{Promise.resolve().then(s.bind(s,8464))},8464:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>v});var r=s(1070),t=s(3246),o=s(9877),n=s(11),l=s(5377),i=s(8975),d=s(2546),c=s(4326),m=s(5583),u=s(9132),x=s(2810),p=s(5738),b=s(5678),g=s(7889),h=s(6552);let y={style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}};function f(e){let{clientSecret:a,totalPrice:s,onPaymentSuccess:o,onPaymentError:n,onProcessing:i}=e,d=(0,b.useStripe)(),c=(0,b.useElements)(),[m,u]=(0,t.useState)("card"),[x,p]=(0,t.useState)(!1),[f,j]=(0,t.useState)({qrCodeUrl:null,pixCopyPaste:null}),N=async e=>{if(e.preventDefault(),i(!0),p(!0),n(""),!d||!c){n("Stripe n\xe3o foi inicializado corretamente."),i(!1),p(!1);return}let s=c.getElement(b.CardElement);if(!s){n("Elemento do cart\xe3o n\xe3o encontrado."),i(!1),p(!1);return}let{error:r,paymentIntent:t}=await d.confirmCardPayment(a,{payment_method:{card:s}});r?n(r.message||"Ocorreu um erro ao processar o pagamento com cart\xe3o."):t&&"succeeded"===t.status?o(t.id):n("O pagamento com cart\xe3o n\xe3o foi bem-sucedido. Status: "+(null==t?void 0:t.status)),i(!1),p(!1)},v=async()=>{i(!0),p(!0),n(""),j({qrCodeUrl:null,pixCopyPaste:null});try{await new Promise(e=>setTimeout(e,1500)),j({qrCodeUrl:"https://www.gstatic.com/webp/gallery/1.webp",pixCopyPaste:"00020126580014br.gov.bcb.pix0136123e4567-e12b-12d1-a456-42665544000053039865802BR5913NOME DO LOJISTA6008CIDADEBR62070503***6304ABCD"})}catch(e){n(e.message||"Falha ao gerar informa\xe7\xf5es do PIX.")}finally{i(!1),p(!1)}};return(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Escolha o M\xe9todo de Pagamento:"}),(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>u("card"),className:"px-4 py-2 rounded-md flex items-center justify-center w-full ".concat("card"===m?"bg-[#1E5F8C] text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[(0,r.jsx)(g.A,{className:"mr-2",size:20})," Cart\xe3o de Cr\xe9dito/D\xe9bito"]}),(0,r.jsxs)("button",{type:"button",onClick:()=>u("pix"),className:"px-4 py-2 rounded-md flex items-center justify-center w-full ".concat("pix"===m?"bg-[#1E5F8C] text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[(0,r.jsx)(h.A,{className:"mr-2",size:20})," PIX"]})]})]}),"card"===m&&(0,r.jsxs)("form",{onSubmit:N,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"cardNumber",className:"block text-gray-700 font-medium mb-2",children:"Dados do Cart\xe3o"}),(0,r.jsx)(b.CardElement,{id:"cardNumber",options:y,className:"p-3 border border-gray-300 rounded-md"})]}),(0,r.jsxs)("button",{type:"submit",disabled:!d||x,className:"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-green-400 disabled:opacity-50 flex items-center justify-center",children:[x?(0,r.jsx)(l.A,{className:"animate-spin mr-2"}):null,"Pagar R$ ",s.toFixed(2)," com Cart\xe3o"]})]}),"pix"===m&&(0,r.jsxs)("div",{children:[!f.qrCodeUrl&&!f.pixCopyPaste&&(0,r.jsxs)("button",{type:"button",onClick:v,disabled:x,className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 disabled:opacity-50 flex items-center justify-center",children:[x?(0,r.jsx)(l.A,{className:"animate-spin mr-2"}):null,"Gerar PIX para Pagar R$ ",s.toFixed(2)]}),f.qrCodeUrl&&(0,r.jsxs)("div",{className:"mt-4 p-4 border border-gray-300 rounded-md text-center",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Pague com PIX"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Escaneie o QR Code abaixo com o app do seu banco:"}),(0,r.jsx)("img",{src:f.qrCodeUrl,alt:"PIX QR Code",className:"mx-auto mb-2 max-w-xs"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Ou use o c\xf3digo Copia e Cola:"}),(0,r.jsx)("input",{type:"text",value:f.pixCopyPaste||"",readOnly:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 text-sm text-center mb-2",onClick:e=>e.target.select()}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Ap\xf3s o pagamento, a confirma\xe7\xe3o pode levar alguns instantes. Aguarde nesta tela ou verifique seu e-mail."})]})]})]})}var j=s(653);let N=(0,p.c)(j.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY||"");function v(){let[e,a]=(0,t.useState)([]),[s,p]=(0,t.useState)(!0),[g,h]=(0,t.useState)(null),[y,j]=(0,t.useState)({name:"",email:"",phone:"",cep:"",address:"",neighborhood:"",city:"",state:"",deliveryDate:(0,o.A)(new Date,"yyyy-MM-dd"),notes:""}),[v,C]=(0,t.useState)(""),[E,w]=(0,t.useState)(0),[F,P]=(0,t.useState)(!1),[S,A]=(0,t.useState)(null),[k,D]=(0,t.useState)(null),[q,_]=(0,t.useState)(!1),[z,I]=(0,t.useState)(!1),[O,R]=(0,t.useState)(null),[M,T]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{p(!0);try{let e=await fetch("/api/plans-static");if(!e.ok)throw Error("Falha ao carregar planos");let s=await e.json(),r=s.plans||s;if(a(r),r.length>0){let e=r[0];h(e)}}catch(e){console.error("Erro ao carregar planos:",e),A("N\xe3o foi poss\xedvel carregar os planos dispon\xedveis. Por favor, tente novamente mais tarde.")}finally{p(!1)}})()},[]),(0,t.useEffect)(()=>{g&&y.deliveryDate&&U(g,y.deliveryDate)},[g,y.deliveryDate]);let B=async e=>{if(e&&8===e.length){_(!0);try{let a=await fetch("https://viacep.com.br/ws/".concat(e,"/json/"));if(!a.ok)throw Error("CEP n\xe3o encontrado");let s=await a.json();if(s.erro){A("CEP n\xe3o encontrado. Verifique o n\xfamero informado.");return}j(e=>({...e,address:s.logradouro,neighborhood:s.bairro,city:s.localidade,state:s.uf})),A(null)}catch(e){console.error("Erro ao buscar CEP:",e),A("N\xe3o foi poss\xedvel buscar o endere\xe7o pelo CEP. Por favor, preencha manualmente.")}finally{_(!1)}}},U=(e,a)=>{if(e&&a)try{let s=new Date(a+"T00:00:00"),r=(0,n.A)(s,e.duration_days);C((0,o.A)(r,"yyyy-MM-dd")),w(e.price)}catch(e){console.error("Erro ao calcular datas:",e)}},X=e=>{let{name:a,value:s}=e.target;j(e=>({...e,[a]:s})),"cep"===a&&8===s.length&&B(s)},L=async e=>{if(e.preventDefault(),!g){A("Por favor, selecione um plano.");return}if(!y.name||!y.email||!y.phone||!y.cep||!y.address){A("Por favor, preencha todos os campos obrigat\xf3rios.");return}P(!0),A(null),D(null),I(!1);try{let e=await fetch("/api/stripe/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:100*g.price,currency:"brl",description:"Aluguel: ".concat(g.name),customerEmail:y.email})}),a=await e.json();if(!e.ok||!a.clientSecret)throw Error(a.error||"Falha ao iniciar o pagamento.");R(a.clientSecret),I(!0)}catch(e){console.error("Erro ao iniciar pagamento:",e),A(e.message||"N\xe3o foi poss\xedvel iniciar o processo de pagamento. Tente novamente.")}finally{P(!1)}};return s?(0,r.jsx)("div",{className:"container mx-auto px-4 py-12 flex justify-center items-center h-screen",children:(0,r.jsx)(l.A,{className:"h-12 w-12 animate-spin text-[#1E5F8C]"})}):(0,r.jsx)("div",{className:"container mx-auto px-4 py-12",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-center mb-2 text-[#1E5F8C]",children:"Agende sua Bota Pneum\xe1tica"}),(0,r.jsx)("p",{className:"text-center text-gray-600 mb-8",children:"Preencha o formul\xe1rio abaixo para agendar o aluguel."}),S&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:S}),k&&(0,r.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6",children:k}),z?O&&N&&(0,r.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 border-b pb-2",children:"Complete seu Pagamento"}),(0,r.jsx)(b.Elements,{stripe:N,options:{clientSecret:O},children:(0,r.jsx)(f,{clientSecret:O,totalPrice:E,onPaymentSuccess:a=>{D("Agendamento e Pagamento (ID: ".concat(a,") realizados com sucesso! Entraremos em contato.")),I(!1),j({name:"",email:"",phone:"",cep:"",address:"",neighborhood:"",city:"",state:"",deliveryDate:(0,o.A)(new Date,"yyyy-MM-dd"),notes:""}),h(e.length>0?e[0]:null),window.scrollTo(0,0)},onPaymentError:e=>{A("Falha no Pagamento: ".concat(e)),I(!0)},onProcessing:e=>{T(e)}})}),M&&(0,r.jsxs)("div",{className:"flex justify-center items-center mt-4",children:[(0,r.jsx)(l.A,{className:"h-6 w-6 animate-spin text-[#1E5F8C]"}),(0,r.jsx)("span",{className:"ml-2",children:"Processando pagamento..."})]}),(0,r.jsx)("button",{onClick:()=>{I(!1),A(null)},className:"mt-4 text-sm text-gray-600 hover:text-gray-800",disabled:M,children:"Voltar e editar agendamento"})]}):(0,r.jsxs)("form",{onSubmit:L,className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 border-b pb-2",children:"Escolha seu Plano"}),0===e.length&&!s&&(0,r.jsx)("p",{children:"Nenhum plano dispon\xedvel no momento."}),e.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"plan",className:"block text-gray-700 font-medium mb-2",children:"Selecione o Plano"}),(0,r.jsx)("select",{id:"plan",name:"plan",value:(null==g?void 0:g.id)||"",onChange:a=>{let s=parseInt(a.target.value);h(e.find(e=>e.id===s)||null)},className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0,children:e.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," - ",e.duration_days," ",1===e.duration_days?"dia":"dias"," - R$ ",e.price.toFixed(2)]},e.id))})]}),g&&(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,r.jsx)("h3",{className:"font-semibold text-lg mb-2",children:g.name}),g.description&&(0,r.jsx)("p",{className:"text-gray-600 mb-2",children:g.description}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-gray-700",children:["Dura\xe7\xe3o: ",g.duration_days," ",1===g.duration_days?"dia":"dias"]}),(0,r.jsxs)("span",{className:"text-[#1E5F8C] font-bold text-xl",children:["R$ ",g.price.toFixed(2)]})]})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 border-b pb-2",children:"Datas"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"deliveryDate",className:"block text-gray-700 font-medium mb-2",children:[(0,r.jsx)(i.A,{className:"inline-block mr-2",size:18}),"Data de Entrega"]}),(0,r.jsx)("input",{type:"date",id:"deliveryDate",name:"deliveryDate",value:y.deliveryDate,onChange:X,min:(0,o.A)(new Date,"yyyy-MM-dd"),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"returnDate",className:"block text-gray-700 font-medium mb-2",children:[(0,r.jsx)(i.A,{className:"inline-block mr-2",size:18}),"Data de Retirada"]}),(0,r.jsx)("input",{type:"date",id:"returnDate",name:"returnDate",value:v,className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-100",disabled:!0}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Data calculada automaticamente"})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 border-b pb-2",children:"Seus Dados"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"name",className:"block text-gray-700 font-medium mb-2",children:[(0,r.jsx)(d.A,{className:"inline-block mr-2",size:18}),"Nome Completo"]}),(0,r.jsx)("input",{type:"text",id:"name",name:"name",value:y.name,onChange:X,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"email",className:"block text-gray-700 font-medium mb-2",children:[(0,r.jsx)(c.A,{className:"inline-block mr-2",size:18}),"E-mail"]}),(0,r.jsx)("input",{type:"email",id:"email",name:"email",value:y.email,onChange:X,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"phone",className:"block text-gray-700 font-medium mb-2",children:[(0,r.jsx)(m.A,{className:"inline-block mr-2",size:18}),"Telefone (WhatsApp)"]}),(0,r.jsx)("input",{type:"tel",id:"phone",name:"phone",value:y.phone,onChange:X,placeholder:"(11) 99999-9999",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"cep",className:"block text-gray-700 font-medium mb-2",children:[(0,r.jsx)(u.A,{className:"inline-block mr-2",size:18}),"CEP"]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",id:"cep",name:"cep",value:y.cep,onChange:X,placeholder:"Somente n\xfameros",maxLength:8,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0}),q&&(0,r.jsx)(l.A,{className:"absolute right-3 top-3 h-4 w-4 animate-spin text-[#1E5F8C]"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Digite o CEP para preenchimento autom\xe1tico"})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 border-b pb-2",children:"Endere\xe7o de Entrega"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"address",className:"block text-gray-700 font-medium mb-2",children:[(0,r.jsx)(x.A,{className:"inline-block mr-2",size:18}),"Endere\xe7o Completo"]}),(0,r.jsx)("input",{type:"text",id:"address",name:"address",value:y.address,onChange:X,placeholder:"Rua, n\xfamero, complemento",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"neighborhood",className:"block text-gray-700 font-medium mb-2",children:"Bairro"}),(0,r.jsx)("input",{type:"text",id:"neighborhood",name:"neighborhood",value:y.neighborhood,onChange:X,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"city",className:"block text-gray-700 font-medium mb-2",children:"Cidade"}),(0,r.jsx)("input",{type:"text",id:"city",name:"city",value:y.city,onChange:X,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"state",className:"block text-gray-700 font-medium mb-2",children:"Estado"}),(0,r.jsx)("input",{type:"text",id:"state",name:"state",value:y.state,onChange:X,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",required:!0})]})]})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"notes",className:"block text-gray-700 font-medium mb-2",children:"Observa\xe7\xf5es Adicionais"}),(0,r.jsx)("textarea",{id:"notes",name:"notes",value:y.notes,onChange:X,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C]",placeholder:"Alguma informa\xe7\xe3o extra para a entrega ou sobre o uso?"})]}),(0,r.jsxs)("button",{type:"submit",disabled:F||!g||M,className:"w-full bg-[#1E5F8C] hover:bg-[#164A6F] text-white font-bold py-3 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1E5F8C] focus:ring-opacity-50 disabled:opacity-50 flex items-center justify-center",children:[F?(0,r.jsx)(l.A,{className:"animate-spin mr-2"}):null,"Finalizar Agendamento e Ir para Pagamento"]})]})]})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[761,520,939,358],()=>a(8014)),_N_E=e.O()}]);